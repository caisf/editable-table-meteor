(function(e){e.fn.editableTableWidget=function(t){"use strict";return e(this).each(function(){var n=function(){var t=e.extend({},e.fn.editableTableWidget.defaultOptions);t.editor=t.editor.clone();return t},r=e.extend(n(),t),i=37,s=38,o=39,u=40,a=13,f=27,l=9,c=e(this),h=r.editor.css("position","absolute").hide().appendTo(c.parent()),p,d=function(e){p=c.find("td:focus");if(p.length){h.val(p.text()).removeClass("error").show().offset(p.offset()).css(p.css(r.cloneProperties)).width(p.width()).height(p.height()).focus();if(e){h.select()}}},v=function(){var t=h.val(),n=e.Event("change"),r;if(p.text()===t||h.hasClass("error")){return true}r=p.html();p.text(t).trigger(n,t);if(n.result===false){p.html(r)}},m=function(e,t){if(t===o){return e.next("td")}else if(t===i){return e.prev("td")}else if(t===s){return e.parent().prev().children().eq(e.index())}else if(t===u){return e.parent().next().children().eq(e.index())}return[]};h.blur(function(){v();h.hide()}).keydown(function(e){if(e.which===a){v();h.hide();p.focus();e.preventDefault();e.stopPropagation()}else if(e.which===f){h.val(p.text());e.preventDefault();e.stopPropagation();h.hide();p.focus()}else if(e.which===l){p.focus()}else if(this.selectionEnd-this.selectionStart===this.value.length){var t=m(p,e.which);if(t.length>0){t.focus();e.preventDefault();e.stopPropagation()}}}).on("input paste",function(){var t=e.Event("validate");p.trigger(t,h.val());if(t.result===false){h.addClass("error")}else{h.removeClass("error")}});c.on("click keypress dblclick",d).css("cursor","pointer").keydown(function(t){var n=true,r=m(e(t.target),t.which);if(r.length>0){r.focus()}else if(t.which===a){d(false)}else if(t.which===17||t.which===91||t.which===93){d(true);n=false}else{n=false}if(n){t.stopPropagation();t.preventDefault()}});c.find("td").prop("tabindex",1);e(window).on("resize",function(){if(h.is(":visible")){h.offset(p.offset()).width(p.width()).height(p.height())}})})};e.fn.editableTableWidget.defaultOptions={cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right"],editor:e("<input>")}})(jQuery)
